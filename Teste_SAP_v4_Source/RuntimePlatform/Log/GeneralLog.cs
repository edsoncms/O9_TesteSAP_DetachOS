/* 
 This source code (the "Generated Software") is generated by the OutSystems Platform 
 and is licensed by OutSystems (http://www.outsystems.com) to You solely for testing and evaluation 
 purposes, unless You and OutSystems have executed a specific agreement covering the use terms and 
 conditions of the Generated Software, in which case such agreement shall apply. 
*/

using System;
using OutSystems.RuntimeCommon;

namespace OutSystems.HubEdition.RuntimePlatform.Log {
    [Serializable()]
    public class GeneralLog : ICloneable {
        // TODO : Create readonly accessor function for this batch of variables
        public DateTime Instant;
        public string SessionId;
        public int EspaceId;
        public int TenantId;
        public int UserId;
        public string Message;
        public string MessageType;
        public string ModuleName;
        public string ErrorId;
        public string RequestKey;
        public string EntrypointName;
        public string ActionName;
        // END OF TODO

        public const int MAX_ACTION_NAME = 60;
        public const int MAX_SESSION_ID_SIZE = 50;
        public const int MAX_MESSAGE_SIZE = 2000;
        public const int MAX_MESSAGE_TYPE_SIZE = 10;
        public const int MAX_MODULE_NAME_SIZE = 15;
        public const int MAX_ERROR_ID_SIZE = 50;

        [NonSerialized()]
        private Action<GeneralLog> logger = log => RuntimeLogger.Log(log);

        public GeneralLog() {
        }

        public GeneralLog(DateTime instant, string sessionId, int espaceId, int tenantId, int userId, string message, string messageType, string moduleName, string errorId) {
            Instant = instant;
            SessionId = sessionId;
            EspaceId = espaceId;
            TenantId = tenantId;
            UserId = userId;
            Message = message;
            MessageType = messageType;
            ModuleName = moduleName;
            ErrorId = errorId;

            RequestTracer reqTracer = RuntimePlatformUtils.GetRequestTracer();
            if (reqTracer != null) {
                RequestKey = reqTracer.RequestKey;
                ActionName = reqTracer.EntryActionName;
                EntrypointName = reqTracer.EntryEndpointName;
            }
        }
       

        public GeneralLog(GeneralLog obj) {
            Instant = obj.Instant;
            SessionId = obj.SessionId;
            EspaceId = obj.EspaceId;
            TenantId = obj.TenantId;
            UserId = obj.UserId;
            Message = obj.Message;
            MessageType = obj.MessageType;
            ModuleName = obj.ModuleName;
            ErrorId = obj.ErrorId;
            RequestKey = obj.RequestKey;
            ActionName = obj.ActionName;
            EntrypointName = obj.EntrypointName;
        }

        public object Clone() {
            return new GeneralLog(this);
        }

        public static void StaticWrite(
                DateTime instant,
                string sessionId,
                int espaceId,
                int tenantId,
                int userId,
                string message,
                string messageType,
                string moduleName,
                string errorId) 
        {
            GeneralLog log = new GeneralLog();
            log.Write(instant, sessionId, espaceId, tenantId, userId, message, messageType, moduleName, errorId);
        }

        public void LogTo(Action<GeneralLog> logger) {
            this.logger = logger;
        }

        public void Write() {
            logger(this);
        }

        public void Write(
            DateTime instant,
            string sessionId,
            int espaceId,
            int tenantId,
            int userId,
            string message,
            string messageType,
            string moduleName,
            string errorId) 
        {
            Instant = instant;
            SessionId = sessionId;
            EspaceId = espaceId;
            TenantId = tenantId;
            UserId = userId;
            Message = message;
            MessageType = messageType;
            ErrorId = errorId;
            ModuleName = moduleName;


            RequestTracer reqTracer = RuntimePlatformUtils.GetRequestTracer();
            if (reqTracer != null) {
                RequestKey = reqTracer.RequestKey;
                ActionName = reqTracer.EntryActionName;
                EntrypointName = reqTracer.EntryEndpointName;  
            }

            this.Write();
        }
    }
}
