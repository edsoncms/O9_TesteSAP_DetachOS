/* 
 This source code (the "Generated Software") is generated by the OutSystems Platform 
 and is licensed by OutSystems (http://www.outsystems.com) to You solely for testing and evaluation 
 purposes, unless You and OutSystems have executed a specific agreement covering the use terms and 
 conditions of the Generated Software, in which case such agreement shall apply. 
*/

using System;
using System.Collections;
using System.Collections.Generic;
using System.Reflection;
using System.Runtime.Serialization;
using System.Text;
using OutSystems.RuntimeCommon;

namespace OutSystems.HubEdition.RuntimePlatform.Log {
    [Serializable()]
    public class RequestEvent : ICloneable {
        public const int KEY_MAXSIZE = 36;
        public const int NAME_MAXSIZE = 50;
        public const int DETAILS_MAXSIZE = 2000;

        public DateTime Instant { get; private set; }

        public string ModuleKey { get; private set; }
        public string ModuleName { get; private set; }
        public string ApplicationKey { get; private set; }
        public string ApplicationName { get; private set; }

        public string RequestKey { get; set; }
        public string RequestEventName { get; set; }
        public string _eventDetails;
        public string EventDetails {
            get {
                return _eventDetails.IsEmpty() ? "{}" : _eventDetails;
            }
            private set {
                _eventDetails = value;
            }
        }

        public bool Contains(string name, string value) {
            return EventDetails.IndexOf("\"" + name + "\":\"" + value + "\"") != -1;
        }

        public bool ExistsInEventDetails(string name) {
            return EventDetails.IndexOf("\"" + name + "\":\"") != -1;
        }

        [NonSerialized()] 
        private Action<RequestEvent> logger = log => RuntimeLogger.Log(log);

        public RequestEvent() { }

        public RequestEvent(DateTime Instant, string RequestKey, string RequestEventName, string ModuleKey, string ModuleName, string ApplicationKey, string ApplicationName, string EventDetails) {
            this.Instant = Instant;
            this.RequestKey = RequestKey;
            this.RequestEventName = RequestEventName;
            this.ModuleKey = ModuleKey;
            this.ModuleName = ModuleName;
            this.ApplicationKey = ApplicationKey;
            this.ApplicationName = ApplicationName;
            this.EventDetails = EventDetails;
        }
        
        public RequestEvent(RequestEvent obj) {
            this.Instant = obj.Instant;
            this.RequestKey = obj.RequestKey;
            this.RequestEventName = obj.RequestEventName;
            this.ModuleKey = obj.ModuleKey;
            this.ModuleName = obj.ModuleName;
            this.ApplicationKey = obj.ApplicationKey;
            this.ApplicationName = obj.ApplicationName;
            this.EventDetails = obj.EventDetails;
        }

        public object Clone() {
            return new RequestEvent(this);
        }

        public void LogTo(Action<RequestEvent> logger) {
            this.logger = logger;
        }

        public static void StaticWrite(DateTime Instant, string RequestKey, string RequestEventName, string ModuleKey, string ModuleName, string ApplicationKey, string ApplicationName, string EventDetails) {
            RequestEvent log = new RequestEvent(Instant, RequestKey, RequestEventName, ModuleKey, ModuleName, ApplicationKey, ApplicationName, EventDetails);
            log.Write();
        }

        public void Write() {
            logger(this);
        }
    }
}
