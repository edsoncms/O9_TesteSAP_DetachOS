/* 
 This source code (the "Generated Software") is generated by the OutSystems Platform 
 and is licensed by OutSystems (http://www.outsystems.com) to You solely for testing and evaluation 
 purposes, unless You and OutSystems have executed a specific agreement covering the use terms and 
 conditions of the Generated Software, in which case such agreement shall apply. 
*/

ï»¿using System;
using System.Configuration;
using System.Web;
using System.Web.Configuration;
using OutSystems.HubEdition.RuntimePlatform.SessionState;
using OutSystems.RuntimeCommon;
using OutSystems.HubEdition.RuntimePlatform;


namespace OutSystems.RuntimePublic {

    /// <summary>
    /// API used to access information about the current session
    /// </summary>
    public static class Session {

        /// <summary>
        /// 	Based on the session cookie from the current HTTP request, this method will look
		///		in the session database for the UserId of the user currently logged in the user
		///		provider of the application that calls this method.
		///		Will return 0 if:
		///			There is no session cookie on the HTTP request.
		///			There is no user logged in with the same session cookie.
		///			There is a user logged in, but only in a different user provider.
        /// </summary>
		/// <returns>The UserId of the user currently logged in.</returns>

        public static int GetUserFromSessionCookie() {
            string sessionId=GetCurrentSession();
            if (!sessionId.IsNullOrEmpty()) {
                return SqlSessionStateStore.GetUserId(sessionId);
            }
            return 0;
        }

        private static string GetCurrentSession() {
            var cookie = HttpContext.Current.Request.Cookies.Get(CookieActions.GetSessionCookieName());
            if (cookie != null)
                return cookie.Value;
            return "";
        }
    }

}